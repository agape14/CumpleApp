# CumpleApp - Reglas y Contexto para Cursor

## üìã Contexto del Proyecto

**CumpleApp** es una aplicaci√≥n web desarrollada en Laravel 11 para gestionar y recordar los cumplea√±os de familiares y amigos. Incluye un sistema automatizado de notificaciones, gesti√≥n de regalos, relaciones familiares, √°rbol geneal√≥gico, y sistema de cuotas mensuales.

### Stack Tecnol√≥gico
- **Backend**: Laravel 11, PHP 8.2+
- **Base de Datos**: MySQL 5.7+
- **Frontend**: Blade Templates, Bootstrap 5.3.2, Bootstrap Icons, Chart.js 4.4.0
- **Autenticaci√≥n**: Sistema personalizado con middleware `familiar.auth`
- **Email**: Laravel Mail (SMTP)
- **APIs**: Google Calendar, WhatsApp (Twilio)

## üèóÔ∏è Arquitectura y Estructura

### Modelos Principales
- `Familiar`: Modelo central con relaciones a todos los dem√°s
- `Parentesco`: Tipos de parentesco (Padre, Madre, Hermano, etc.)
- `IdeaRegalo`: Ideas de regalos asociadas a familiares
- `RelacionFamiliar`: Relaciones entre familiares (padres, hijos, pareja)
- `RegaloDado`: Historial de regalos dados
- `Recordatorio`: Recordatorios personalizados por familiar
- `CuotaMensual`: Sistema de cuotas mensuales para hermanos
- `ConfiguracionUsuario`: Configuraciones del usuario

### Relaciones Eloquent Importantes
```php
Familiar::class
  - belongsTo(Parentesco::class)
  - hasMany(IdeaRegalo::class)
  - hasMany(RelacionFamiliar::class, 'familiar_id')
  - hasMany(RelacionFamiliar::class, 'familiar_relacionado_id')
  - hasMany(RegaloDado::class)
  - hasMany(Recordatorio::class)
  - hasMany(CuotaMensual::class, 'hermano_id')
  - belongsTo(Familiar::class, 'created_by')
  - belongsTo(Familiar::class, 'updated_by')
```

### Accesorios del Modelo Familiar
- `age`: Edad actual calculada
- `zodiacSign`: Signo zodiacal calculado
- `next_birthday`: Pr√≥ximo cumplea√±os
- `days_until_birthday`: D√≠as hasta el pr√≥ximo cumplea√±os

## üìù Convenciones de C√≥digo

### Nomenclatura
- **Tablas y campos de BD**: Espa√±ol (snake_case)
  - Ejemplos: `familiares`, `fecha_nacimiento`, `parentesco_id`
- **Clases y m√©todos**: Ingl√©s (PascalCase para clases, camelCase para m√©todos)
  - Ejemplos: `FamiliarController`, `getNextBirthdayAttribute()`
- **Rutas**: Espa√±ol (kebab-case)
  - Ejemplos: `/familiares`, `/cuotas-mensuales`, `/arbol-genealogico`

### Est√°ndares de C√≥digo
- ‚úÖ **PSR-12** coding standards
- ‚úÖ **C√≥digo documentado** con PHPDoc
- ‚úÖ **Validaciones robustas** en controladores
- ‚úÖ **Type hints** en m√©todos (return types)
- ‚úÖ **Eager loading** para optimizar consultas
- ‚úÖ **Separaci√≥n de responsabilidades**

### Estructura de Controladores
```php
// M√©todos est√°ndar para Resource Controllers
public function index(): View
public function create(): View
public function store(Request $request): RedirectResponse
public function show(Familiar $familiar): View
public function edit(Familiar $familiar): View
public function update(Request $request, Familiar $familiar): RedirectResponse
public function destroy(Familiar $familiar): RedirectResponse
```

### Validaci√≥n de Datos
- Siempre usar `$request->validate()` en controladores
- Mensajes de validaci√≥n personalizados en espa√±ol
- Validar relaciones con `exists:tabla,id`

### Vistas Blade
- Layout principal: `resources/views/layouts/app.blade.php`
- Usar componentes de Bootstrap 5
- Iconos de Bootstrap Icons
- Mensajes de √©xito/error con sesiones flash
- Protecci√≥n CSRF en todos los formularios

## üîê Seguridad

- ‚úÖ **Protecci√≥n CSRF** en todos los formularios (`@csrf`)
- ‚úÖ **Validaci√≥n de datos** en backend (nunca confiar solo en frontend)
- ‚úÖ **Sanitizaci√≥n de inputs** autom√°tica con Eloquent
- ‚úÖ **Integridad referencial** en base de datos
- ‚úÖ **Eliminaci√≥n en cascada** configurada en migraciones
- ‚úÖ **Escapado autom√°tico** en Blade (`{{ }}`)
- ‚úÖ **Middleware de autenticaci√≥n** `familiar.auth` para rutas protegidas

## üé® Frontend y UI/UX

### Dise√±o
- **Paleta de colores**: Gradientes p√∫rpura-azul (#667eea ‚Üí #764ba2)
- **Tipograf√≠a**: Segoe UI, sans-serif
- **Iconograf√≠a**: Bootstrap Icons 1.11.1
- **Animaciones**: Transiciones CSS suaves
- **Responsividad**: Mobile-first con Bootstrap 5

### Componentes Visuales
- Cards con sombras y hover effects
- Botones con border-radius redondeado
- Badges coloridos para estados
- Tablas con hover interactivo
- Formularios con validaci√≥n visual
- Gr√°ficos de barras animados (Chart.js)
- Modales para acciones secundarias

### Mensajes al Usuario
- Usar sesiones flash para mensajes: `Session::flash('success', 'Mensaje')`
- Mostrar mensajes con Bootstrap alerts
- Iconos descriptivos (‚úÖ, ‚ùå, ‚ö†Ô∏è, üí°)

## üóÑÔ∏è Base de Datos

### Convenciones de Migraciones
- Nombres de tablas en plural y espa√±ol: `familiares`, `parentescos`
- Campos de auditor√≠a: `created_by`, `updated_by`, `created_at`, `updated_at`
- Relaciones con `foreignId()` y `constrained()->onDelete('cascade')`
- √çndices en campos de b√∫squeda frecuente

### Campos Importantes
- `familiares.dni`: DNI del familiar (puede ser null)
- `familiares.puede_acceder`: Boolean para control de acceso
- `familiares.notificar`: Boolean para activar/desactivar notificaciones
- `cuotas_mensuales.tipo_cuota`: 'mensual' o 'especial'
- `cuotas_mensuales.anio` y `mes`: Pueden ser null para colectas especiales

## üöÄ Comandos Artisan

### Comandos Existentes
- `php artisan familiar:listar` - Lista todos los familiares
- `php artisan familiar:buscar [nombre]` - Buscar familiar por nombre
- `php artisan familiar:dni {id} {dni}` - Asignar DNI a familiar
- `php artisan birthdays:send-reminders` - Enviar recordatorios de cumplea√±os

### Estructura de Comandos
```php
protected $signature = 'comando:accion {argumento} {--opcion}';
protected $description = 'Descripci√≥n del comando';
public function handle() { /* l√≥gica */ }
```

## üìß Sistema de Notificaciones

- Comando programado: `birthdays:send-reminders` (diario a las 8:00 AM)
- Mailable: `BirthdayReminderMail`
- Plantilla: `resources/views/emails/birthday-reminder.blade.php`
- Configuraci√≥n en `app/Console/Kernel.php`

## üîÑ Rutas y Middleware

### Rutas Protegidas
Todas las rutas (excepto login) est√°n protegidas con middleware `familiar.auth`:
```php
Route::middleware(['familiar.auth'])->group(function () {
    // Rutas protegidas aqu√≠
});
```

### Rutas Principales
- `/` - Dashboard
- `/familiares` - CRUD de familiares
- `/cuotas-mensuales` - Gesti√≥n de cuotas
- `/arbol-genealogico` - Visualizaci√≥n de √°rbol
- `/configuracion` - Configuraci√≥n del usuario

## üéØ Reglas Generales para Desarrollo

### Al Crear Nuevas Funcionalidades

1. **Modelos**:
   - Definir relaciones Eloquent
   - Agregar campos a `$fillable`
   - Configurar `$casts` para tipos de datos
   - Agregar accesorios si es necesario
   - Documentar con PHPDoc

2. **Controladores**:
   - Validar todos los inputs
   - Usar type hints en m√©todos
   - Retornar tipos espec√≠ficos (View, RedirectResponse, JsonResponse)
   - Usar eager loading para optimizar consultas
   - Manejar errores apropiadamente

3. **Migraciones**:
   - Nombres descriptivos con fecha
   - Campos en espa√±ol (snake_case)
   - Agregar √≠ndices donde sea necesario
   - Configurar relaciones con foreign keys
   - Agregar campos de auditor√≠a si aplica

4. **Vistas**:
   - Usar layout principal
   - Proteger formularios con `@csrf`
   - Mostrar mensajes de validaci√≥n
   - Usar componentes de Bootstrap
   - Hacer responsive

5. **Rutas**:
   - Agregar al grupo de middleware apropiado
   - Usar nombres descriptivos en espa√±ol
   - Agregar validaci√≥n de par√°metros si es necesario

### Al Modificar C√≥digo Existente

- ‚úÖ Mantener consistencia con el c√≥digo existente
- ‚úÖ No cambiar convenciones establecidas
- ‚úÖ Actualizar documentaci√≥n si es necesario
- ‚úÖ Probar que las relaciones Eloquent sigan funcionando
- ‚úÖ Verificar que las validaciones sean correctas
- ‚úÖ Asegurar que las vistas sean responsive

### Buenas Pr√°cticas

- ‚úÖ **Eager Loading**: Usar `with()` para evitar N+1 queries
- ‚úÖ **Validaci√≥n**: Siempre validar en backend
- ‚úÖ **Mensajes**: Usar espa√±ol para mensajes al usuario
- ‚úÖ **C√≥digo limpio**: Nombres descriptivos, c√≥digo documentado
- ‚úÖ **Optimizaci√≥n**: Usar √≠ndices en BD, optimizar consultas
- ‚úÖ **Seguridad**: Nunca confiar en datos del cliente
- ‚úÖ **UX**: Feedback visual, mensajes claros, dise√±o intuitivo

## üìö Recursos y Documentaci√≥n

### Archivos de Documentaci√≥n
- `README.md` - Documentaci√≥n principal
- `ESTRUCTURA_PROYECTO.md` - Estructura completa
- `RESUMEN_EJECUTIVO.md` - Resumen del proyecto
- `GUIA_AUTENTICACION.md` - Sistema de autenticaci√≥n
- `GUIA_COMANDOS_ARTISAN.md` - Comandos disponibles

### Comandos √ötiles
```bash
# Desarrollo
php artisan serve
php artisan migrate
php artisan migrate:fresh --seed

# Limpiar cach√©
php artisan cache:clear
php artisan config:clear
php artisan view:clear
php artisan route:clear

# Optimizaci√≥n
php artisan optimize
php artisan config:cache
php artisan route:cache
```

## ‚ö†Ô∏è Consideraciones Importantes

1. **Autenticaci√≥n**: El sistema usa autenticaci√≥n personalizada, NO Laravel Auth est√°ndar
2. **Idioma**: Mensajes al usuario en espa√±ol, c√≥digo en ingl√©s
3. **Base de Datos**: Nombres de tablas y campos en espa√±ol
4. **Relaciones**: Muchas relaciones complejas entre modelos, revisar antes de modificar
5. **Auditor√≠a**: Campos `created_by` y `updated_by` para tracking
6. **Cuotas**: Sistema especial para cuotas mensuales y colectas especiales

## üéì Patrones y Estructuras Comunes

### Estructura de Respuesta JSON
```php
return response()->json([
    'success' => true,
    'message' => 'Operaci√≥n exitosa',
    'data' => $data
]);
```

### Estructura de Mensajes Flash
```php
Session::flash('success', 'Operaci√≥n realizada correctamente');
Session::flash('error', 'Ocurri√≥ un error');
```

### Estructura de Validaci√≥n
```php
$validated = $request->validate([
    'campo' => 'required|tipo|reglas',
], [
    'campo.required' => 'Mensaje personalizado en espa√±ol',
]);
```

---

**Nota**: Este archivo debe mantenerse actualizado conforme el proyecto evolucione. Siempre revisar la estructura actual del proyecto antes de hacer cambios significativos.

